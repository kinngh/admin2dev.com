<html lang="fr-FR"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Cours de démarrage Apex | Admin2Dev</title>
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@500&amp;family=Spartan:wght@500;600;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Muli:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="../assets/css/stylesheet.css">

  <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">

  <meta property="og:site_name" content="Admin2Dev">

  <meta property="og:title" content="Apex Test Class"> <!-- Content Title-->
  <meta property="og:description" content="Learn how to write test classes to get 100% code coverage for your apex code"> <!-- Content Description -->
  <meta property="og:image" content="https://a2d-cdn.now.sh/web-image.png">
  <meta property="og:url" content="https://admin2dev.com/">


  <meta property="article:author" content="https://twitter.com/kinngh">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Apex Test Class"> <!-- Twitter Title -->
  <meta name="twitter:description" content="Learn how to write test classes to get 100% code coverage for your apex code"> <!-- Twitter description -->
  <meta name="twitter:url" content="https://admin2dev.com">
  <meta name="twitter:label1" content="Written by">
  <meta name="twitter:data1" content="Harshdeep Singh Hura">
  <meta name="twitter:label2" content="Filed under">
  <meta name="twitter:data2" content="Apex Tutorials">
  <meta name="twitter:site" content="@kinngh">
  <meta name="twitter:creator" content="@kinngh">
  <meta name="twitter:image" content="https://a2d-cdn.now.sh/web-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-112097931-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());

  gtag('config', 'UA-112097931-2');
</script><script async src="https://hm-ackee.herokuapp.com/tracker.js" data-ackee-server="https://hm-ackee.herokuapp.com" data-ackee-domain-id="b76d74a9-da14-46a7-b30a-596c57329e5b"></script>

</head>

<body id="myBody" class="global-hash-post-card-amber global-hash-post-card-apricot global-hash-post-card-aqua global-hash-post-card-coral global-hash-post-card-cream global-hash-post-card-green global-hash-post-card-purple global-hash-post-card-raspberry global-hash-post-card-sky is-loaded">
  <div class="global-wrap">
    <div class="global-content">
      <header class="header-section">
        <div class="header-wrap">
          <div class="header-logo">
            <a href="../index.html" class="is-image">
              <img src="../images/logo.png" alt="Admin2Dev">
            </a>
          </div>
          <div class="header-nav">
            <input id="toggle" class="header-checkbox" type="checkbox">
            <label class="header-toggle" for="toggle">
              <span>
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
              </span>
            </label>
            <nav>
              <ul>
                <li><a href="../index.html">Accueil</a></li>
                <li><a href="../learn/index.html">Apprendre</a></li>
<li><a href="../tools/index.html">Outils</a></li>
                 <li><a href="../sponsor/index.html">Commanditaire</a></li>
                <li class="header-nav-dropdown">
                  <svg role="img" viewBox="0 0 20 4" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2 4A2 2 0 102.001.001 2 2 0 002 4zm8 0a2 2 0 10.001-3.999A2 2 0 0010 4zm8 0a2 2 0 10.001-3.999A2 2 0 0018 4z"></path></svg>
                  <ul>
                    <li><a href="../about/index.html">À propos</a></li><li><a href="../terms.html">Conditions d'utilisation</a></li>
                    <li><a href="../privacy.html">Politique de confidentialité</a></li>
                  </ul>
                </li>
              </ul>
              <ul>
                <li class="signup global-button"><a href="https://discord.gg/5ndr5F8" target="_blank">Rejoignez la communauté</a></li>
                <li class="signin"><a onclick="darkMode()" id="darkModeText">Mode sombre</a></li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main class="global-main">
        <article class="post-section">
          <div class="post-header item is-hero is-page is-first post no-image page">
            <div class="item-container global-color">
              <div class="item-content">
                <h2 class="item-title">Classe d'essai Apex</h2>
              </div>
            </div>
          </div>
          <div class="post-content">
            <p>Jusqu'à présent, nous avons écrit du code à la volée, sans nous soucier de savoir si le code se briserait et ce n'est vraiment pas une bonne pratique. En production, vos utilisateurs trouveront des moyens intéressants et créatifs de casser votre code et je l'ai appris à la dure (sur d'autres plates-formes). Salesforce ne permet pas aux développeurs d'écrire du code directement en production. Au lieu de cela, tout le code va d'abord dans l'environnement du développeur et doit avoir une couverture de code de 75 %. Cela signifie qu'au moins 75 % de chaque ligne de code écrite doit être exécutée par la classe de test et ne pas être comptabilisée dans la limite de code de l'organisation.</p>
            <h2>Notions de base de la classe d'essai</h2>
            <p>Every test class is marked as test by using <code>@isTest</code> before declaring the class and for better structure, every test class keeps the same name as the class we are writing it for and has the word <code>Test</code> at the end
              of it. Let's write our test class for <code>FirstName</code> Class:</p>
            <pre><code>@isTest
public class FirstNameTest{

}
</code></pre>
            <p>Every method we write for our test class is marked with <code>testmethod</code>:</p>
            <pre><code>@isTest
public class FirstNameTest{
	static testmethod void methodName(){
	}
}
</code></pre>
            <p>Alternatively, test methods can be marked with <code>@isTest</code> too:</p>
            <pre><code>@isTest
public class FirstnameTest{
	@isTest static void methodName(){
	}
}
</code></pre>
            <p>Both ways of declaring a test method are correct and is compeltely on you to choose. I prefer using the <code>testmethod</code> keyword unless there is a need to use <code>@isTest</code> parameters. We cover it later in the course. The
              visibility (public/private/global) of the method doesn't matter and is ommited.</p>
            <p>Just like <code>System.debug()</code> is essential to output logs in console, we use <code>System.assertEquals()</code> to compare two values, and it returns a <code>Boolean</code>. There are two ways of using it:</p>
            <pre><code>System.assertEquals(expectedValue, givenValue);

System.assetEquals(expectedValue, givenValue, String_If_Value_Is_False);
</code></pre>
            <p><code>System.assertEquals</code> compares <code>expectedValue</code> and <code>givenValue</code>. If the values are same it returns <code>true</code> and <code>false</code> if they are different. Let's look at few examples:</p>
            <pre><code>Integer a = 1, b = 2;
System.assertEquals(a, b); //This will be false
</code></pre>
            <p>Lorsque vous exécutez ceci dans la fenêtre Exec Anon, vous serez accueilli avec une erreur :</p>
            <pre><code>Line: 2, Column: 1
System.AssertException: Assertion Failed: The values are not same: Expected: 1, Actual: 2
</code></pre>
            <p>À la ligne 2, lorsque nous comparons les valeurs de a et b, la console s'attendait à ce que la valeur de b soit 1, mais en a obtenu 2 à la place. Remplaceons maintenant la valeur de a par 2 à la place et cochons :</p>
            <pre><code>Integer b = 2;
System.assertEquals(2, b);
</code></pre>
            <p>To see the optional String parameter in action, we have to write a class. Let's write a class <code>calculator</code> that has a method <code>addition</code> which takes two <code>Integer</code> as parameter and adds them and sees if
              the final result is <code>4</code>.</p>
            <pre><code>public class Calculator {

    public static void addition(Integer a, Integer b){
        Integer c = a + b;
        System.assertEquals(4, c, 'The result is not 4');
    }

}
</code></pre>
            <p>Maintenant, dans la fenêtre Exec Anon, appelons la classe. Tout d'abord, ajoutons 2 et 2 afin que nous sachions que notre code s'exécute réellement"</p>
            <pre><code>calculator.addition(2, 2);
</code></pre>
            <p>Great! Now let's add <code>2</code> and <code>5</code>.</p>
            <pre><code>calculator.addition(2, 5);
</code></pre>
            <p>Vous remarquerez que vous serez accueilli par une erreur :</p>
            <pre><code>Line: 5, Column: 1
System.AssertException: Assertion Failed: The result is not 4: Expected: 4, Actual: 7
</code></pre>
            <p>We wanted this code block to fail and that's exactly what happened <em>The result is not 4</em> is the third optional string from<code>System.assertEqual()</code> .</p>
            <p>Maintenant que nous connaissons la plupart des bases, écrivons une classe de test pour une classe Apex.</p>
            <h2>Tests pour la classe Apex</h2>
            <p>Let's use the same caluclator class but add in <code>multiplication</code> method too! The <code>Calculator</code> class should look something like this:</p>
            <pre><code>public class Calculator{

    public static Integer addition(Integer a, Integer b){
        return a+b;
    }

    public static Integer multiplication(Integer a, Integer b){
        return a*b;
    }
}
</code></pre>
            <p>The <code>addition</code> method returns the sum of a and b, while the <code>multiplication</code> method returns the product of a and b. Now let's write a test class. For this, create a new class and name it
              <code>CalculatorTest</code> and mark it as a test class using the <code>@isTest</code>. Now, let's write our <code>additionTest</code> method that checks for values using <code>System.assertEquals()</code>.</p>
            <pre><code>@isTest
public class CalculatorTest {
    static testmethod void additionTest(){
        Integer result = Calculator.addition(2,2);
        System.assertEquals(4, result, 'Unexpected result');
    }

}
</code></pre>
            <p>Décomposons d'abord ce code :</p>
            <ul>
              <li>Nous créons une classe de test nommée<code>CalculatorTest</code></li>
              <li>Nous avons une méthode de test appelée<code>additionTest()</code></li>
              <li>We save the result from <code>Calculator.addition</code> in an Integer called <code>result</code></li>
              <li>We compare values to see if the result we were expecting (4) was the same as what the class returned (<code>result</code>)</li>
            </ul>
            <p>Now to run our test, we go to <code>Test</code> menu of Developer Console, and click on <code>New Run</code>. This will open a new popup. Select the <code>CalculatorTest</code> from the left most window pane, then select
              <code>additionTest</code> and click on <code>Run</code> on bottom right.</p>
            <figure class="kg-card kg-image-card kg-card-hascaption"><img src="../images/apex/18/1.png" width="100%" alt="Popup de test">
            </figure>
            <p>To see the results of the test, we select the <code>Test</code> in the bottom pane. This will show all the tests we ran this session. Click on the test run and select the <code>Calculator</code> from the bottom right pane.</p>
            <figure class="kg-card kg-image-card kg-card-hascaption"><img src="../images/apex/18/2.png" width="100%" alt="Espace inférieur d'essai">
            </figure>
            <p>Remarquez comment il est dit</p>
            <div class="responsive-table">
              <table>
                <thead>
                  <tr>
                    <th>Classe</th>
                    <th>Pourcentage</th>
                    <th>Lignes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Calculateur</td>
                    <td>50 %</td>
                    <td>2/4</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <p>This means out of the 4 lines of code we wrote in our <code>Calculator</code> class (class declarations are not counted here, only the user written code), only 2 lines of code ran. Double clicking on this would open up the class and
              highlight what lines of code ran and what didn't. This is particularly useful to see what lines of code were missed out and in our case, the two lines of <code>multiplication</code> method didn't run. Let's add to our Test Classs to
              cover it.</p>
            <pre><code>@isTest
public class CalculatorTest {
    static testmethod void additionTest(){
        Integer result = Calculator.addition(2,2);
        System.assertEquals(4, result, 'Unexpected result');
    }

    static testmethod void multiplicationTest(){
        Integer result = Calculator.multiplication(2,3);
        System.assertEquals(6, result, 'Unexpected result');
    }

}
</code></pre>
            <p>Head over to <code>Test</code> and Run a new test to see the results. Now we have 100% code coverage! To practice more, write tests for classes we have written through out the course.</p>
            <blockquote>Utilisez Test &gt; Effacer les données de test pour effacer vos journaux de test.</blockquote>
            <h2>Essais pour la classe de lots</h2>
            <p>Let's write a test class for our <code>ClassBatch</code> Class we wrote earlier in this course. Incase you forgot, here's the code:</p>
            <pre><code>global class ClassBatch implements Database.Batchable&lt;sObject&gt;{


    global iterable&lt;sObject&gt; start(Database.BatchableContext bc){
    	 //return all contacts where the last name is Test

        String qString = 'SELECT ID, LastName FROM Contact WHERE LastName = \'Test\'';
        return Database.query(qString);
    }

    global void execute(Database.BatchableContext bc, List&lt;Contact&gt; conList){
		 //Make the first name and last name the same

        List&lt;Contact&gt; finalList = new List&lt;Contact&gt;();
        for (Contact iterator: conList){
            iterator.firstName = iterator.LastName;
        }
        update finalList;
    }

    global void finish(Database.BatchableContext bc){
        System.debug('Batch successfully executed');
    }

}
</code></pre>
            <p>Les méthodes de test d'écriture pour les classes par lots sont un peu différentes de l'écriture pour les classes régulières. Lorsque nous exécutons une classe de test, elle crée des données dans une base de données distincte de l'organisation pour éviter que des modifications ne soient apportées à la base de données de production. Pensez-y comme ça, lorsque vous essayez une nouvelle façon de faire du café, comme passer de l'utilisation de la bonne vieille presse française à l'utilisation d'une machine à expresso, vous en faites beaucoup plus petite quantité que d'habitude pour éviter de gaspiller votre café et de tester le goût de la nouvelle méthode.</p>
            <p>Pour écrire une classe de test pour notre <code>ClassBatch</code>, nous faisons d'abord un nouveau fichier de classe.</p>
            <pre><code>@isTest
public class ClassBatchTest {

}
</code></pre>
            <p>Now we need to create some test data. For this, we need to create a new method and declare it as <code>@testSetup</code>. Marking a method with <code>@testSetup</code> makes it the first method to run in the test class, despite it's
              position in the code (Remember code always runs line by line).</p>
            <pre><code>@isTest
public class ClassBatchTest {

    @testSetup static void createTestData(){

    }

}
</code></pre>
            <p>Now let's make a loop that inserts 3 contacts with the last name <code>Test</code> and name <code>Name 1</code>, <code>Name 2</code> and <code>Name 3</code>.</p>
            <pre><code>@isTest
public class ClassBatchTest {

    @testSetup static void createTestData(){
		List&lt;Contact&gt; finalList = new List&lt;Contact&gt;();
        for(Integer i = 1; i&lt;=3; i++){
            Contact iterator = new Contact();
            iterator.firstName = 'Name '+ i;
            iterator.lastName = 'Test';
            finalList.add(iterator);
        }
        insert finalList;

    }

}
</code></pre>
            <p>This inserts three records in our <code>test</code> database that's not directly accessible from the org because the database is only available as the testing process is running and is destroyed after it's done.</p>
            <p>Now, let's write our <code>testmethod</code> method. We will be using the <code>Test.startTest()</code> and <code>Test.stopTest();</code> here. These methods denote <em>when the test is starting/ending</em>.</p>
            <pre><code>@isTest
public class ClassBatchTest {

    @testSetup static void createTestData(){
		List&lt;Contact&gt; finalList = new List&lt;Contact&gt;();
        for(Integer i = 1; i&lt;=3; i++){
            Contact iterator = new Contact();
            iterator.firstName = 'Name '+ i;
            iterator.lastName = 'Test';
            finalList.add(iterator);
        }
        insert finalList;

    }

    static testMethod void batchTester(){

        Test.startTest();
        ClassBatch tester = new ClassBatch();
        Id jobId = Database.executeBatch(tester);
        Test.stopTest();

        System.assertEquals(3, [SELECT count() FROM Contact WHERE LastName = 'Test'], 'Last Name error');
        System.assertEquals(3, [SELECT count() FROM Contact WHERE FirstName = 'Test'], 'First Name error');
        System.assertEquals(3, [SELECT count() FROM Contact WHERE LastName = 'Test' AND FirstName = 'Test'], 'Names are not equal error');

    }

}
</code></pre>
            <p>Let's breakdown the <code>batchTester()</code> method:</p>
            <ul>
              <li>We run our batch class inside the <code>Test.startTest()</code> and <code>Test.stopTest()</code> because we want to run it as a test and reset governor limits.</li>
              <li>We use three <code>System.assertEquals()</code> to ensure our test ran successfully:
                <ul>
                  <li>Le premier vérifie si les 3 nouveaux enregistrements que nous avons créés ont été insérés avec succès.</li>
                  <li>Le second vérifie si les prénoms ont été mis à jour après l'enregistrement de la classe de lots, indiquant que la classe de lot s'est exécutée avec succès</li>
                  <li>Le troisième est une vérification redondante pour s'assurer que les contacts où le prénom et le nom de famille sont test existent dans la base de données et qu'ils donnent 3 parce que c'est le nombre de contacts que nous avons insérés dans la base de données de test.</li>
                </ul>
              </li>
            </ul>
            <p>Cela peut sembler compliqué au premier abord, mais en réalité, tout ce que nous faisons est de créer du contenu factice et de voir si les valeurs qu'il renvoie sont les mêmes que la valeur attendue.</p>
            <h1>Résumé</h1>
            <ul>
              <li>Les classes de test sont nécessaires et doivent avoir une couverture de code de 75 % avant d'être déployées en production</li>
              <li><code>System.assertEquals</code> compares a given value to expected value and returns <code>Boolean</code> based on the outcome</li>
              <li>Toutes les classes d'essai doivent être marquées avec<code>@isTest</code></li>
              <li>All test methods must be marked with <code>testMethod</code> or <code>@isTest</code></li>
              <li><code>Test.startTest()</code> and <code>Test.stopTest()</code> denote start/stop of a test insdie a method</li>
            </ul>



            <a href="19.html" class="global-button">Jour 19 : Test de classe Apex</a>
          </div>
        </article>

      </main>
      <footer class="footer-section global-footer">
        <div class="footer-copyright">© <a href="http://harshdeephura.com" target="_blank">Harshdeep Singh Hura</a>.<br>Tous droits réservés.</div>
      </footer>
    </div>
  </div>




  <script src="../assets/js/global.js"></script>




</body></html>

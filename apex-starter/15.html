<html lang="es-ES"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Curso Apex Starter | Admin2Dev</title>
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@500&amp;family=Spartan:wght@500;600;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Muli:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="../assets/css/stylesheet.css">

  <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">

  <meta property="og:site_name" content="Admin2Dev">

  <meta property="og:title" content="Batch Apex Test"> <!-- Content Title-->
  <meta property="og:description" content="Test your knowledge on what you've learnt"> <!-- Content Description -->
  <meta property="og:image" content="https://a2d-cdn.now.sh/web-image.png">
  <meta property="og:url" content="https://admin2dev.com/">


  <meta property="article:author" content="https://twitter.com/kinngh">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Batch Apex Test"> <!-- Twitter Title -->
  <meta name="twitter:description" content="Test your knowledge on what you've learnt"> <!-- Twitter description -->
  <meta name="twitter:url" content="https://admin2dev.com">
  <meta name="twitter:label1" content="Written by">
  <meta name="twitter:data1" content="Harshdeep Singh Hura">
  <meta name="twitter:label2" content="Filed under">
  <meta name="twitter:data2" content="Apex Tutorials">
  <meta name="twitter:site" content="@kinngh">
  <meta name="twitter:creator" content="@kinngh">
  <meta name="twitter:image" content="https://a2d-cdn.now.sh/web-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-112097931-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());

  gtag('config', 'UA-112097931-2');
</script><script async="" src="https://hm-ackee.herokuapp.com/tracker.js" data-ackee-server="https://hm-ackee.herokuapp.com" data-ackee-domain-id="b76d74a9-da14-46a7-b30a-596c57329e5b"></script>

</head>

<body id="myBody" class="global-hash-post-card-amber global-hash-post-card-apricot global-hash-post-card-aqua global-hash-post-card-coral global-hash-post-card-cream global-hash-post-card-green global-hash-post-card-purple global-hash-post-card-raspberry global-hash-post-card-sky global-hash-dark-version is-loaded">
  <div class="global-wrap">
    <div class="global-content">
      <header class="header-section">
        <div class="header-wrap">
          <div class="header-logo">
            <a href="../index.html" class="is-image">
              <img src="../images/logo.png" alt="Admin2Dev">
            </a>
          </div>
          <div class="header-nav">
            <input id="toggle" class="header-checkbox" type="checkbox">
            <label class="header-toggle" for="toggle">
              <span>
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
              </span>
            </label>
            <nav>
              <ul>
                <li><a href="../index.html">Inicio</a></li>
                <li><a href="../learn/index.html">Aprender</a></li>
<li><a href="../tools/index.html">Herramientas</a></li>
                 <li><a href="../sponsor/index.html">Patrocinador</a></li>
                <li class="header-nav-dropdown">
                  <svg role="img" viewBox="0 0 20 4" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2 4A2 2 0 102.001.001 2 2 0 002 4zm8 0a2 2 0 10.001-3.999A2 2 0 0010 4zm8 0a2 2 0 10.001-3.999A2 2 0 0018 4z"></path></svg>
                  <ul>
                    <li><a href="../about/index.html">Acerca de</a></li><li><a href="../terms.html">Condiciones del servicio</a></li>
                    <li><a href="../privacy.html">Política de privacidad</a></li>
                  </ul>
                </li>
              </ul>
              <ul>
                <li class="signup global-button"><a href="https://discord.gg/5ndr5F8" target="_blank">Únete a la comunidad</a></li>
                <li class="signin"><a onclick="darkMode()" id="darkModeText">Modo de luz</a></li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <main class="global-main">
        <article class="post-section">
          <div class="post-header item is-hero is-page is-first post no-image page">
            <div class="item-container global-color">
              <div class="item-content">
                <h2 class="item-title">Prueba de ápice por lotes</h2>
              </div>
            </div>
          </div>
          <div class="post-content">

            <p>Esta prueba rápida se hace para probar su comprensión básica de Batch Apex.</p>
            <ul>
              <li>Puedes mirar la sintaxis, puntos de bonificación si no lo haces.</li>
              <li>Lo ideal sería que la prueba no tardara más de 15 minutos en resolverse.</li>
              <li>Se deben cumplir todos los criterios.</li>
              <li>La respuesta está disponible en <a href="https://github.com/Admin2Dev/answers" target="_blank">Admin2Dev GitHub Repo</a>.</li>
              <li>La respuesta y el desglose completo del programa están disponibles al final de esta página.</li>
            </ul>
            <h2>La prueba</h2>
            <h3>Pregunta</h3>
            <ul>
              <li>Insert 250 contacts with the last name "Test n" where n is a number starting from 1. For reference, the names should look like <code>Test 1</code>, <code>Test 2</code> .. .<code>Test 250</code>.</li>
              <li>Si se crea un contacto con el apellido <code>DeleteBatch</code>, debe ejecutar una clase Batch Apex que elimine todos los contactos con el apellido "Test n" donde n es un número.</li>
              <li>Cuando el Ápice por lotes termine de ejecutarse, debe actualizar la descripción del contacto "Eliminar" con "Registros borrados con IDJobID" donde JobID debe ser el ID de la clase Ápice por lotes.</li>
            </ul>
            <h5>Pista</h5>
            <ul>
              <li>Use <code>getJobID()</code> method on <code>Database.batchableContext</code> variable to get the Job ID.</li>
              <li>Use the escape character <code>\</code> to add <code>'</code> to your Strings. So to write <code>'Test'</code>, you have to write <code> \'Test\'</code> instead.</li>
              <li>Los cambios pueden no ser visibles al instante. Dale unos 5 minutos antes de ver los contactos que se eliminan y las actualizaciones de la descripción.</li>
            </ul>
            <hr>
            <blockquote>
              <p>Inicie un temporizador y anote cuánto tiempo tarda en resolverlo. Idealmente, debería tomar ~15 minutos, pero no te preocupes si te pasas por la borda.</p>
            </blockquote>
            <hr>
            <h2>Respuesta</h2>
            <h3>Insertando 250 registros</h3>
            <ul>
              <li>Puede crear una clase y llamarla desde Anon Exec Window, o insertar directamente 250 registros sin clases.</li>
            </ul>
            <pre><code>List&lt;Contact&gt; finalList = new List&lt;Contact&gt;();

for(Integer i = 1; i&lt;=250; i++){
    Contact con = new Contact();
    con.lastName = 'Test ' + i;
    finalList.add(con);
}
insert finalList;

System.debug('Inserted ' + finalList.size() + ' records.');</code></pre>
            <h3>Ápice por lotes</h3>
            <ul>
              <li>Mi clase de lote se llama <code>batchDeleter</code>.</li>
            </ul>
            <pre><code>global class batchDeleter implements Database.Batchable&lt;sObject&gt; {

    global Database.QueryLocator start(Database.BatchableContext bc) {
        return Database.getQueryLocator('SELECT Id, LastName FROM Contact WHERE LastName LIKE \'Test%\'');
    }

    global void execute(Database.BatchableContext bc, List&lt;sObject&gt; deleteList){
        delete deleteList;
    }
    global void finish(Database.BatchableContext bc){
        List&lt;Contact&gt; con = [SELECT Id, LastName FROM Contact WHERE LastName = 'DeleteBatch' LIMIT 1];
        List&lt;Contact&gt; finalList = new List&lt;Contact&gt;();
        for (Contact iterator: con){
            iterator.Description = 'Deleted records with ID ' + bc.getJobId();
            finalList.add(iterator);
        }
        update finalList;

    }
}</code></pre>
            <ul>
              <li>First we return all values that have Last Name <code>Test%</code> where <code>%</code> is a wildcard.</li>
              <li>En el método execute, simplemente eliminamos toda la lista.</li>
              <li>En el método finish, seleccionamos el contacto 'DeleteBatch' y para estar realmente seguros de que obtenemos solo 1 valor, usamos la palabra clave <code>Limit</code>.</li>
              <li>Ahora iteramos sobre nuestra lista y actualizamos su descripción para que coincida con el identificador de trabajo por lotes.<ul>
                  <li><code>bc</code> comes from the method parameter <code>Database.BatchableContext bc</code> and running <code>.getJobId()</code> returns the ID.</li>
                </ul>
              </li>
              <li>Then the values are commited to the database using the <code>update</code> statement.</li>
            </ul>
            <h3>Disparador</h3>
            <ul>
              <li>Queremos que la clase por lotes se ejecute cuando el registro haya terminado de insertarse, por lo que escribir un disparador con una clase helper es la única manera en que podemos controlar la ejecución de nuestra clase por lotes.</li>
            </ul>
            <h4>Archivo de activación</h4>
            <pre><code>trigger LastName on Contact(after insert){
    if (Trigger.isAfter){
        if (Trigger.isInsert){
            LastNameHelper.deleteContacts(trigger.new);
        }
    }
}</code></pre>
            <h4>Archivo de ayuda de Tigger</h4>
            <pre><code>public class LastNameHelper{

    public static void deleteContacts(List&lt;Contact&gt; newList){

        for(Contact iterator: newList){
            if (iterator.LastName == 'DeleteBatch'){
                batchDeleter runBatch = new batchDeleter();
                Database.executeBatch(runBatch);

            }
        }

    }
}</code></pre>
            <ul>
              <li>In our Helper Class, every time a new contact is inserted we use <code>Trigger.new</code> to pass all records, and in the helper class check for last name. If the last name matches our condition, we run the Batch Class.</li>
            </ul>
            <a href="16.html" class="global-button">Día 16: SOQL Avanzado</a>
          </div>
        </article>

      </main>
      <footer class="footer-section global-footer">
        <div class="footer-copyright">© <a href="http://harshdeephura.com" target="_blank">Harshdeep Singh Hura</a>.<br>Todos los derechos reservados.</div>
      </footer>
    </div>
  </div>




  <script src="../assets/js/global.js"></script>




</body></html>
